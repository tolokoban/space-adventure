/**********************************************************************
 require( 'require' )
 -----------------------------------------------------------------------
 @example

 var Path = require("node://path");  // Only in NodeJS/NW.js environment.
 var Button = require("tfw.button");

 **********************************************************************/

window.require = function() {
    var modules = {};
    var definitions = {};
    var nodejs_require = typeof window.require === 'function' ? window.require : null;

    var f = function(id, body) {
        if( id.substr( 0, 7 ) == 'node://' ) {
            // Calling for a NodeJS module.
            if( !nodejs_require ) {
                throw Error( "[require] NodeJS is not available to load module `" + id + "`!" );
            }
            return nodejs_require( id.substr( 7 ) );
        }

        if( typeof body === 'function' ) {
            definitions[id] = body;
            return;
        }
        var mod;
        body = definitions[id];
        if (typeof body === 'undefined') {
            var err = new Error("Required module is missing: " + id);   
            console.error(err.stack);
            throw err;
        }
        mod = modules[id];
        if (typeof mod === 'undefined') {
            mod = {exports: {}};
            var exports = mod.exports;
            body(f, mod, exports);
            modules[id] = mod.exports;
            mod = mod.exports;
            //console.log("Module initialized: " + id);
        }
        return mod;
    };
    return f;
}();
function addListener(e,l) {
    if (window.addEventListener) {
        window.addEventListener(e,l,false);
    } else {
        window.attachEvent('on' + e, l);
    }
};

addListener(
    'DOMContentLoaded',
    function() {
        document.body.parentNode.$data = {};
        // Attach controllers.
        APP = require('app');
setTimeout(function (){if(typeof APP.start==='function')APP.start()});

    }
);
require("$",function(n,r,a){a.config={name:'"space-adventure"',description:'"WebGL clone of Cavalcadeur\'s original game."',author:'"tolokoban"',version:'"0.0.6"',major:"0",minor:"0",revision:"6",date:"2017-02-05T21:50:56.000Z",consts:{}};var o=null;a.lang=function(n){return void 0===n&&(window.localStorage&&(n=window.localStorage.getItem("Language")),n||(n=window.navigator.language,n||(n=window.navigator.browserLanguage,n||(n="fr"))),n=n.substr(0,2).toLowerCase()),o=n,window.localStorage&&window.localStorage.setItem("Language",n),n},a.intl=function(n,r){var o,e,t,i,g,l,u,s=n[a.lang()],c=r[0];for(u in n)break;if(!u)return c;if(!s&&(s=n[u],!s))return c;if(o=s[c],o||(s=n[u],o=s[c]),!o)return c;if(r.length>1){for(e="",g=0,t=0;t<o.length;t++)i=o.charAt(t),"$"===i?(e+=o.substring(g,t),t++,l=o.charCodeAt(t)-48,e+=l<0||l>=r.length?"$"+o.charAt(t):r[l],g=t+1):"\\"===i&&(e+=o.substring(g,t),t++,e+=o.charAt(t),g=t+1);e+=o.substr(g),o=e}return o}});
//# sourceMappingURL=$.js.map
require("app",function(t,e,n){var r=function(){function e(){return r(n,arguments)}var n={en:{},fr:{}},r=t("$").intl;return e.all=n,e}(),i=t("tfw.webgl"),u=t("play"),a=document.getElementById("canvas"),o=new i.Renderer(a),w=u.init(o.gl,a);w.then(function(){u.reset(),o.start(function(t){var e=window.innerWidth,n=window.innerHeight;a.setAttribute("width",e),a.setAttribute("height",n),o.gl.viewport(0,0,e,n),u.draw(t)})}),e.exports._=r});
//# sourceMappingURL=app.js.map
require("play",function(e,r,n){function a(){t.disable(t.DEPTH_TEST),t.enable(t.BLEND),t.clearColor(28/255,134/255,182/255,1),t.clear(t.COLOR_BUFFER_BIT)}var t,o,i,l,_,u,c,E,f,s=function(){function r(){return a(n,arguments)}var n={en:{},fr:{}},a=e("$").intl;return r.all=n,r}(),d=e("global"),w=e("hero"),A=e("moon"),m=e("smoke"),M=(e("tfw.webgl"),e("image-loader"),e("event-handler"),1600);(new Float32Array).BYTES_PER_ELEMENT,Math.sqrt(2),new Float32Array(16);n.init=function(e,r){return t=e,o=r,new Promise(function(e,r){w.ready.then(e)})},n.reset=function(){w.reset(t),A.reset(t),m.reset(t)},n.draw=function(e){if(t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),e*=.001,w.move(e),A.move(e),0==E)return E=e,void(c=0);var r=e-E;i=(.5*d.COL_W+_*e)%d.GAME_W,u>0?(u-=M*r,u<0&&(u=0)):u<0&&(u+=M*r,u>0&&(u=0)),l+=u*r,l>d.GAME_H-f?(l=d.GAME_H-f,u=-Math.abs(u)):l<f&&(l=f,u=Math.abs(u)),d.cameraX=w.x(),d.cameraY=.5*d.COL_H,a(),A.draw(e),w.draw(e),m.draw(e),E=e},r.exports._=s});
//# sourceMappingURL=play.js.map
require("event-handler",function(n,t,e){var o=function(){function t(){return o(e,arguments)}var e={en:{},fr:{}},o=n("$").intl;return t.all=e,t}(),c=function(){},r=!1;t.exports={on:function(n){c=n},start:function(){r=!0},stop:function(){r=!1}},document.addEventListener("keyup",function(n){r&&(38==n.keyCode?c(1):40==n.keyCode&&c(-1))});var u,i;document.addEventListener("touchstart",function(n){var t=n.changedTouches[0];u=t.clientX,i=t.clientY}),document.addEventListener("touchend",function(n){var t=n.changedTouches[0],e=t.clientX-u,o=t.clientY-i;if(!(Math.abs(e)>Math.abs(o)))return o<0?c(1):o>0?c(-1):void 0}),t.exports._=o});
//# sourceMappingURL=event-handler.js.map
require("image-loader",function(n,r,e){var o=function(){function r(){return o(e,arguments)}var e={en:{},fr:{}},o=n("$").intl;return r.all=e,r}();n("polyfill.promise"),r.exports=function(n){return new Promise(function(r,e){var o,i,t,s,l,u={},a=0,c=function(){a--,0==a&&r(u)},f=function(n){console.error("Unable to load image "+this.src+"! ",n),u[this.$id]=n,c()};for(o in n)i="css/app/"+n[o],t=i.substr(0,i.length-4),s=i.substr(i.length-4),a++,l=new Image,l.$id=o,u[o]=l,l.onload=c,l.onerror=f,l.src=i,l.srcset=t+".mini"+s+" 640w, "+i})},r.exports._=o});
//# sourceMappingURL=image-loader.js.map
require("polyfill.promise",function(t,n,e){var r=function(){function n(){return r(e,arguments)}var e={en:{},fr:{}},r=t("$").intl;return n.all=e,n}();window.Promise||function(){"use strict";function t(t){return"function"==typeof t||"object"==typeof t&&null!==t}function n(t){return"function"==typeof t}function e(t){return"object"==typeof t&&null!==t}function r(){}function o(){return function(){process.nextTick(c)}}function i(){var t=0,n=new q(c),e=document.createTextNode("");return n.observe(e,{characterData:!0}),function(){e.data=t=++t%2}}function s(){var t=new MessageChannel;return t.port1.onmessage=c,function(){t.port2.postMessage(0)}}function u(){return function(){setTimeout(c,1)}}function c(){for(var t=0;t<D;t+=2){var n=K[t],e=K[t+1];n(e),K[t]=void 0,K[t+1]=void 0}D=0}function a(){}function f(){return new TypeError("You cannot resolve a promise with itself")}function l(){return new TypeError("A promises callback cannot return that same promise.")}function h(t){try{return t.then}catch(t){return $.error=t,$}}function p(t,n,e,r){try{t.call(n,e,r)}catch(t){return t}}function _(t,n,e){Y(function(t){var r=!1,o=p(e,n,function(e){r||(r=!0,n!==e?y(t,e):w(t,e))},function(n){r||(r=!0,b(t,n))},"Settle: "+(t._label||" unknown promise"));!r&&o&&(r=!0,b(t,o))},t)}function v(t,n){n._state===U?w(t,n._result):t._state===W?b(t,n._result):g(n,void 0,function(n){y(t,n)},function(n){b(t,n)})}function d(t,e){if(e.constructor===t.constructor)v(t,e);else{var r=h(e);r===$?b(t,$.error):void 0===r?w(t,e):n(r)?_(t,e,r):w(t,e)}}function y(n,e){n===e?b(n,f()):t(e)?d(n,e):w(n,e)}function m(t){t._onerror&&t._onerror(t._result),A(t)}function w(t,n){t._state===N&&(t._result=n,t._state=U,0===t._subscribers.length||Y(A,t))}function b(t,n){t._state===N&&(t._state=W,t._result=n,Y(m,t))}function g(t,n,e,r){var o=t._subscribers,i=o.length;t._onerror=null,o[i]=n,o[i+U]=e,o[i+W]=r,0===i&&t._state&&Y(A,t)}function A(t){var n=t._subscribers,e=t._state;if(0!==n.length){for(var r,o,i=t._result,s=0;s<n.length;s+=3)r=n[s],o=n[s+e],r?P(e,r,o,i):o(i);t._subscribers.length=0}}function j(){this.error=null}function E(t,n){try{return t(n)}catch(t){return z.error=t,z}}function P(t,e,r,o){var i,s,u,c,a=n(r);if(a){if(i=E(r,o),i===z?(c=!0,s=i.error,i=null):u=!0,e===i)return void b(e,l())}else i=o,u=!0;e._state!==N||(a&&u?y(e,i):c?b(e,s):t===U?w(e,i):t===W&&b(e,i))}function T(t,n){try{n(function(n){y(t,n)},function(n){b(t,n)})}catch(n){b(t,n)}}function S(t,n,e,r){this._instanceConstructor=t,this.promise=new t(a,r),this._abortOnReject=e,this._validateInput(n)?(this._input=n,this.length=n.length,this._remaining=n.length,this._init(),0===this.length?w(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&w(this.promise,this._result))):b(this.promise,this._validationError())}function k(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function M(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function O(t,e){this._id=Q++,this._label=e,this._state=void 0,this._result=void 0,this._subscribers=[],a!==t&&(n(t)||k(),this instanceof O||M(),T(this,t))}var C;C=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var R,x=C,D=(Date.now||function(){return(new Date).getTime()},Object.create||function(t){if(arguments.length>1)throw new Error("Second argument not supported");if("object"!=typeof t)throw new TypeError("Argument must be an object");return r.prototype=t,new r},0),Y=function(t,n){K[D]=t,K[D+1]=n,D+=2,2===D&&R()},I="undefined"!=typeof window?window:{},q=I.MutationObserver||I.WebKitMutationObserver,F="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,K=new Array(1e3);R="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?o():q?i():F?s():u();var N=void 0,U=1,W=2,$=new j,z=new j;S.prototype._validateInput=function(t){return x(t)},S.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},S.prototype._init=function(){this._result=new Array(this.length)};var B=S;S.prototype._enumerate=function(){for(var t=this.length,n=this.promise,e=this._input,r=0;n._state===N&&r<t;r++)this._eachEntry(e[r],r)},S.prototype._eachEntry=function(t,n){var r=this._instanceConstructor;e(t)?t.constructor===r&&t._state!==N?(t._onerror=null,this._settledAt(t._state,n,t._result)):this._willSettleAt(r.resolve(t),n):(this._remaining--,this._result[n]=this._makeResult(U,n,t))},S.prototype._settledAt=function(t,n,e){var r=this.promise;r._state===N&&(this._remaining--,this._abortOnReject&&t===W?b(r,e):this._result[n]=this._makeResult(t,n,e)),0===this._remaining&&w(r,this._result)},S.prototype._makeResult=function(t,n,e){return e},S.prototype._willSettleAt=function(t,n){var e=this;g(t,void 0,function(t){e._settledAt(U,n,t)},function(t){e._settledAt(W,n,t)})};var G=function(t,n){return new B(this,t,!0,n).promise},H=function(t,n){function e(t){y(i,t)}function r(t){b(i,t)}var o=this,i=new o(a,n);if(!x(t))return b(i,new TypeError("You must pass an array to race.")),i;for(var s=t.length,u=0;i._state===N&&u<s;u++)g(o.resolve(t[u]),void 0,e,r);return i},J=function(t,n){var e=this;if(t&&"object"==typeof t&&t.constructor===e)return t;var r=new e(a,n);return y(r,t),r},L=function(t,n){var e=this,r=new e(a,n);return b(r,t),r},Q=0,V=O;O.all=G,O.race=H,O.resolve=J,O.reject=L,O.prototype={constructor:O,then:function(t,n,e){var r=this,o=r._state;if(o===U&&!t||o===W&&!n)return this;r._onerror=null;var i=new this.constructor(a,e),s=r._result;if(o){var u=arguments[o-1];Y(function(){P(o,i,u,s)})}else g(r,i,t,n);return i},catch:function(t,n){return this.then(null,t,n)}};var X=function(){var t;t="undefined"!=typeof global?global:"undefined"!=typeof window&&window.document?window:self;var e="Promise"in t&&"resolve"in t.Promise&&"reject"in t.Promise&&"all"in t.Promise&&"race"in t.Promise&&function(){var e;return new t.Promise(function(t){e=t}),n(e)}();e||(t.Promise=V)};X()}.call(this),n.exports._=r});
//# sourceMappingURL=polyfill.promise.js.map
require("tfw.webgl",function(e,t,r){function n(e,t,r){if("string"===(t.vert,!1))throw Error("[tfw.webgl.Program] Missing attribute `vert` in argument `codes`!");if("string"===(t.frag,!1))throw Error("[tfw.webgl.Program] Missing attribute `frag` in argument `codes`!");t=i(t,r);var n=e.createProgram();e.attachShader(n,s(e,t.vert||"//No Vertex Shader")),e.attachShader(n,c(e,t.frag||"//No Fragment Shader")),e.linkProgram(n),this.program=n,Object.freeze(this.program),this.use=function(){e.useProgram(n)},this.use();var u,f,m={},g=e.getProgramParameter(n,e.ACTIVE_ATTRIBUTES);for(u=0;u<g;u++)f=e.getActiveAttrib(n,u),m[f.name]=e.getAttribLocation(n,f.name),this["$"+f.name]=e.getAttribLocation(n,f.name);Object.freeze(m),this.attribs=m;var E={},h=e.getProgramParameter(n,e.ACTIVE_UNIFORMS);for(u=0;u<h;u++)f=e.getActiveUniform(n,u),E[f.name]=e.getUniformLocation(n,f.name),Object.defineProperty(this,"$"+f.name,{set:a(e,f,E[f.name]),get:o(f),enumerable:!0,configurable:!0});Object.freeze(E),this.uniforms=E}function i(e,t){var r,n,i={};for(r in e)n=e[r],i[r]=n.split("\n").map(function(e){if("#include"!=e.trim().substr(0,8))return e;var r=e.indexOf("#include")+8,n=e.substr(r).trim();"'<\"".indexOf(n.charAt(0))>-1&&(n=n.substr(1,n.length-2));var i=t[n];if("string"!=typeof i)throw console.error("Include <"+n+"> not found in ",t),Error("Include not found in shader: "+n);return i}).join("\n");return i}function a(e,t,r){var n="_$"+t.name;switch(t.type){case e.BYTE:case e.UNSIGNED_BYTE:case e.SHORT:case e.UNSIGNED_SHORT:case e.INT:case e.UNSIGNED_INT:return 1==t.size?function(t){e.uniform1i(r,t),this[n]=t}:function(t){e.uniform1iv(r,t),this[n]=t};case e.FLOAT:return 1==t.size?function(t){e.uniform1f(r,t),this[n]=t}:function(t){e.uniform1fv(r,t),this[n]=t}}}function o(e){var t="_$"+e.name;return function(){return this[t]}}function u(e,t,r){var n=t.createShader(e);return t.shaderSource(n,r),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)?n:(console.log(r),console.error("An error occurred compiling the shader: "+t.getShaderInfoLog(n)),null)}function c(e,t){return u(e.FRAGMENT_SHADER,e,t)}function s(e,t){return u(e.VERTEX_SHADER,e,t)}var f=function(){function t(){return n(r,arguments)}var r={en:{}},n=e("$").intl;return t.all=r,t}(),m=function(e){"string"==typeof e&&(e=document.getElementById(e)),Object.defineProperty(this,"canvas",{value:e,writable:!1,configurable:!1,enumerable:!0}),Object.defineProperty(this,"gl",{value:e.getContext("webgl")||e.getContext("experimental-webgl"),writable:!1,configurable:!1,enumerable:!0}),this.render=function(){}};m.prototype.start=function(e){if("function"==typeof e&&(this.render=e),!this._animationIsOn){var t=this,r=function(e){t._animationIsOn&&window.requestAnimationFrame(r),t.render(e)};window.requestAnimationFrame(r),this._animationIsOn=!0}},m.prototype.stop=function(){this._animationIsOn=!1};var g=function(e,t,r){var n=e.createTexture();return e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,r,0,e.RGBA,e.UNSIGNED_BYTE,null),n},E=function(e){var t=e.width,r=e.height,n=document.createElement("canvas");n.setAttribute("width",t),n.setAttribute("height",r);var i=n.getContext("2d");return i.drawImage(e,0,0),i.getImageData(0,0,t,r).data};r.Renderer=m,r.Program=n,r.createTextureForFB=g,r.getDataFromImage=E,t.exports._=f});
//# sourceMappingURL=tfw.webgl.js.map
require("smoke",function(r,e,n){function t(r,e,n){s=r;var t=R*d;a[t++]=e-10,a[t++]=n-40,a[t++]=r,a[t++]=Math.random(),d=(d+1)%c}var a,o,A,u=function(){function e(){return t(n,arguments)}var n={en:{},fr:{}},t=r("$").intl;return e.all=n,e}(),f=r("global"),i=r("hero"),l=r("programs"),_=.01,R=4,c=100,b=null,d=0,s=0;n.ready=new Promise(function(r,e){r()}),n.reset=function(r){b||(b=r,o=b.createBuffer(),A=l(b,"Smoke")),a=new Float32Array(R*c),o=b.createBuffer()},n.draw=function(r){b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA),b.blendFuncSeparate(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA,b.ZERO,b.ONE),b.blendEquation(b.FUNC_ADD),r-s>_&&t(r,i.x()-30*Math.random(),i.y()-30*Math.random()),f.setGlobalUniforms(A,r),b.bindBuffer(b.ARRAY_BUFFER,o),b.bufferData(b.ARRAY_BUFFER,a,b.STATIC_DRAW);var e=f.BPE*R;b.enableVertexAttribArray(A.$attPos),b.vertexAttribPointer(A.$attPos,4,b.FLOAT,!1,e,0),b.drawArrays(b.POINTS,0,c)},e.exports._=u});
//# sourceMappingURL=smoke.js.map
require("programs",function(n,o,e){var a=function(){function o(){return a(e,arguments)}var e={en:{},fr:{}},a=n("$").intl;return o.all=e,o}(),t={vertHero:"#include vertCommon\n#include game2gl  \n\n// Rotation in radians.\nuniform float uniRotation;\n\n// Vertex position and texture coords.\n// (x,y) for vertex position, in game's space.\n// (z,w) for (radius,angle).\nattribute vec4 attPos;\n\nvarying vec2 varUV;\n\nconst float SQRT2 = 1.4142135623730951;\n\nvoid main() {\n  float xG = attPos.x;\n  float yG = attPos.y;\n  // Diagonals must be multiplied by the square root of two.\n  float radius = attPos.z * SQRT2;\n  // Using the angle, we can deduce the corner position.\n  float angle = attPos.w;\n  // Propagate UV to the fragment shader.\n  varUV = vec2( .5 * SQRT2 * cos(angle) + .5,\n                .5 - .5 * SQRT2 * sin(angle) );\n  // Apply hero's self rotation.\n  angle += uniRotation;\n  // Adding some deformations due to \"Infinite Improbability Drive\".\n  radius *= .95 + .1 * cos(uniVTime * angle);\n  // Coords of this corner.\n  vec2 point = game2gl( xG + radius * cos(angle), yG + radius * sin(angle) );\n  \n  // GL has a square space with coords between -1 and +1.\n  // Final position in GL space.\n  gl_Position = vec4( point, 0.0, 1.0 );\n}\n",fragHero:"precision mediump float;\n// The texture is the hero image.\nuniform sampler2D uniTexture;\n// texture coords UV between 0 and +1.\nvarying vec2 varUV;\n\nvoid main() {\n  gl_FragColor = texture2D( uniTexture, varUV );\n}\n",vertMoon:"#include vertCommon\n#include game2gl\n  \n// Obstacle's type.\nattribute float attType;\n// Vertex position and texture coords.\n// (x,y) for vertex position, in game's space.\n// (z,w) for (u,v) texture coords.\nattribute vec2 attPos;\n// Point size.\nattribute float attSize;\n\nvarying float varSize;\nvarying float varAngle;\n\n\nvoid main() {\n  // Propagate size to the fragment shader.\n  varSize = attSize;\n  // Game's space coords.\n  vec2 point = game2gl( attPos );\n  // GL has a square space with coords between -1 and +1.\n  // Final position in GL space.\n  gl_Position = vec4( point, 0.0, 1.0 );\n    \n  // Point's size...\n  gl_PointSize = pointSize( attSize );\n}\n",fragMoon:"precision mediump float;\n\nconst float PI = 3.141592653589793;\nuniform float uniFTime;\n\nvarying float varSize;\nvarying float varAngle;\n\n\nvoid main() {\n  float xx = gl_PointCoord.x * 2.0 - 1.0;\n  float yy = gl_PointCoord.y * 2.0 - 1.0;\n  // Rotation.\n  float x = xx * cos(varAngle) - yy * sin(varAngle);\n  float y = -xx * sin(varAngle) - yy * cos(varAngle);\n    \n  \n  float r = x*x + y*y;\n  if( r > 1.0 ) gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n  else if( r > .8 ) gl_FragColor = vec4(1.0, 1.0, 1.0, 0.5);\n  else {\n    float lat = asin( y );\n    float r = cos( lat );\n    float lng = 0.0;\n    if( r > 0.0 ) {\n      lng = asin( x / r );\n    }\n\n    float shadow = abs( lng );\n    lng = lng + 3.0 * cos(uniFTime * varSize * .01 + 10.0 * varSize);\n    lng = mod(lng + 1.0, 2.0) - 1.0;\n\n    x = mod(1.0 + lng, 1.0);\n    y = mod(1.0 + lat, 1.0);\n\n    if( x < .5 ) {\n      if( y < .5 ) {\n        gl_FragColor = vec4( 0.0, 1.0, 0.0, 1.0 );\n      } else {\n        gl_FragColor = vec4( 0.0, 0.0, 1.0, 1.0 );\n      }\n    } else {\n      if( y < .5 ) {\n        gl_FragColor = vec4( 1.0, 1.0, 1.0, 1.0 );\n      } else {\n        gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n      }\n    }\n\n    gl_FragColor = mix( gl_FragColor, vec4(0.0, 0.0, 0.0, 1.0), shadow);\n  }\n}\n",vertSmoke:"const float PI = 3.141592653589793;\n\n// Time in seconds.\nuniform float uniVTime;\n// Screen dimensions in pixels.\nuniform float uniScrW;\nuniform float uniScrH;\n// Game's space dimension.\nuniform float uniGameW;\nuniform float uniGameH;\n// Where is the camera pointing?\nuniform float uniCamX;\nuniform float uniCamY;\n\nvec2 game2gl(float xG, float yG) {\n  // Where the camera points, the coords are (0,0).\n  xG -= uniCamX;\n  yG -= uniCamY;\n  // Wrapping.\n  if( xG < -.25 * uniGameW ) xG += uniGameW;\n  else if( xG > .75 * uniGameW ) xG -= uniGameW;\n\n  // Convert game coords into screen coords.\n  // A column must fit entirely in the screens height.\n  float factorS = uniScrH / uniGameH;\n  float xS = xG * factorS - uniScrW * .25;\n  float yS = yG * factorS;\n  // Now, convert screen coords into WebGL coords.\n  // Setting the center.\n  float factorW = 2.0 / uniScrW;\n  float factorH = 2.0 / uniScrH;\n  float x = xS * factorW;\n  float y = yS * factorH;  \n\n  return vec2( x, y );\n}\n\n\nvec2 game2gl(vec2 pos) {\n  return game2gl( pos.x, pos.y );\n}\n\n\nvec2 wrap(vec2 pos) {\n  // Wrapping.\n  if( pos.x < -uniGameW ) pos.x += uniGameW;\n  if( pos.x > uniGameW ) pos.x -= uniGameW;\n  return pos;\n}\n\n\n// Vertex position and texture coords.\n// (x,y) for vertex position, in game's space.\n// z: birth.\n// w: random.\nattribute vec4 attPos;\n\nvarying float varRnd;\nvarying float varAge;\n\nconst float CURVATURE = 0.5;\n\nvoid main() {\n  // Propagate random to the fragment shader.\n  varRnd = attPos.w;\n  \n  // Point's size...\n  float age = uniVTime - attPos.z;\n  varAge = age;\n  float size = uniScrH * .05 * (1.0 + varRnd);\n  size *= clamp( age, 0.0, 1.0 );\n  size += 30.0;\n  if( age > 2.0 ) size = 0.0;\n  gl_PointSize = size;\n\n  // Game's space coords.\n  float x = attPos.x - 40.0;\n  float shift = (age - 0.5) * 20.0;\n  shift *= shift;\n  shift -= 130.0;\n  float y = attPos.y + shift;\n  vec2 point = game2gl( x, y );\n  // GL has a square space with coords between -1 and +1.\n  // Final position in GL space.\n  gl_Position = vec4( point, 0.0, 1.0 );\n}\n",fragSmoke:"precision mediump float;\n\nuniform float uniFTime;\n\nvarying float varRnd;\nvarying float varAge;\n\nvoid main() {\n  float x = gl_PointCoord.x - .5;\n  float y = gl_PointCoord.y - .5;\n  float r = sqrt(x*x + y*y);\n  if( r > 0.5 ) gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n  else {\n    float a = 2.0 - varAge;\n    a = clamp(a, 0.0, 1.0);\n    a *= 1.0 - 2.0 * r;\n    float k = .5 * (1.0 + sin(.3 * uniFTime));\n    gl_FragColor = vec4(k, k, k, 0.25 * a);\n  }\n}\n",game2gl:"vec2 game2scr(float xG, float yG) {\n  // Where the camera points, the coords are (0,0).\n  xG -= uniCamX;\n  yG -= uniCamY;\n  // Wrapping.\n  if( xG < -.25 * uniGameW ) xG += uniGameW;\n  else if( xG > .75 * uniGameW ) xG -= uniGameW;\n\n  // Convert game coords into screen coords.\n  // A column must fit entirely in the screens height.\n  float factorS = uniScrH / uniGameH;\n  float xS = xG * factorS - uniScrW * .25;\n  float yS = yG * factorS;\n\n  return vec2(xS, yS);\n}\n\nvec2 game2gl(float xG, float yG) {\n  vec2 scr = game2scr(xG, yG);\n  // Now, convert screen coords into WebGL coords.\n  // Setting the center.\n  float factorW = 2.0 / uniScrW;\n  float factorH = 2.0 / uniScrH;\n  float x = scr.x * factorW;\n  float y = scr.y * factorH;  \n\n  return vec2( x, y );\n}\n\n\nvec2 game2gl(vec2 pos) {\n  return game2gl( pos.x, pos.y );\n}\n\n\nfloat pointSize( float radius ) {\n  float factorS = uniScrH / uniGameH;\n  return 2.0 * radius * factorS;\n}\n\nvec2 wrap(vec2 pos) {\n  // Wrapping.\n  if( pos.x < -uniGameW ) pos.x += uniGameW;\n  if( pos.x > uniGameW ) pos.x -= uniGameW;\n  return pos;\n}\n",vertCommon:"const float PI = 3.141592653589793;\n\n// Time in seconds.\nuniform float uniVTime;\n// Screen dimensions in pixels.\nuniform float uniScrW;\nuniform float uniScrH;\n// Game's space dimension.\nuniform float uniGameW;\nuniform float uniGameH;\n// Where is the camera pointing?\nuniform float uniCamX;\nuniform float uniCamY;\n"},i=n("tfw.webgl");o.exports=function(n,o){var e=t["vert"+o];if(!e)throw Error("Vertex shader not found: vert"+o+"!");var a=t["frag"+o];if(!a)throw Error("Fragment shader not found: frag"+o+"!");return new i.Program(n,{vert:e,frag:a},t)},o.exports._=a});
//# sourceMappingURL=programs.js.map
require("hero",function(t,e,r){var n,a,E,o,i,_,T,u,A,R,P,f=function(){function e(){return n(r,arguments)}var r={en:{},fr:{}},n=t("$").intl;return e.all=r,e}(),c=t("global"),M=t("programs"),L=t("image-loader"),l=t("event-handler"),U=1600,h=null,s=0;r.ready=new Promise(function(t,e){L({hero:"hero.png"}).then(function(e){o=e.hero,t()})}),r.reset=function(t){h||(h=t,a=h.createBuffer(),i=M(h,"Hero")),n=new Float32Array(16),P=0,_=.5*(c.NB_COLS*c.COL_W),T=.5*c.COL_H,u=.8*c.COL_W,A=0,R=c.COL_H/16,console.log(_,T,c),E=h.createTexture(),h.bindTexture(h.TEXTURE_2D,E),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.activeTexture(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,E),h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,o),l.on(function(t){A=666*t}),l.start()},r.draw=function(t){h.blendFunc(h.SRC_ALPHA,h.ONE_MINUS_SRC_ALPHA),c.setGlobalUniforms(i,t),n[0]=_,n[1]=T,n[2]=R,n[3]=.25*Math.PI,n[4]=_,n[5]=T,n[6]=R,n[7]=.75*Math.PI,n[8]=_,n[9]=T,n[10]=R,n[11]=1.25*Math.PI,n[12]=_,n[13]=T,n[14]=R,n[15]=1.75*Math.PI;var e=A>0?Math.sqrt(A):-Math.sqrt(-A);e*=.02,e=Math.min(.5*Math.PI,Math.max(.5*-Math.PI,e)),i.$uniRotation=e,h.bindBuffer(h.ARRAY_BUFFER,a),h.bufferData(h.ARRAY_BUFFER,n,h.STATIC_DRAW),h.enableVertexAttribArray(i.$attPos),h.vertexAttribPointer(i.$attPos,4,h.FLOAT,!1,4*c.BPE,0),h.drawArrays(h.TRIANGLE_FAN,0,4)},r.move=function(t){if(0==P)return void(P=t);var e=t-P;P=t,_=(.5*c.COL_W+u*t)%c.GAME_W,A>0?(A-=U*e,A<0&&(A=0)):A<0&&(A+=U*e,A>0&&(A=0)),T+=A*e,T>c.GAME_H-R?(T=c.GAME_H-R,A=-Math.abs(A)):T<R&&(T=R,A=Math.abs(A))},r.collision=function(t){s=t},r.x=function(){return _},r.y=function(){return T},r.vx=function(){return u},r.vy=function(){return A},r.size=function(){return R},e.exports._=f});
//# sourceMappingURL=hero.js.map
require("global",function(e,n,i){function r(e,i){Object.defineProperty(n.exports,e,{value:i,writable:!1,configurable:!0,enumerable:!0})}var a=function(){function n(){return r(i,arguments)}var i={en:{},fr:{}},r=e("$").intl;return n.all=i,n}();r("BPE",(new Float32Array).BYTES_PER_ELEMENT),r("COL_W",400),r("COL_H",1e3),r("NB_COLS",Math.ceil(4*i.COL_H/i.COL_W)),r("GAME_W",i.NB_COLS*i.COL_W),r("GAME_H",i.COL_H),i.cameraX=0,i.cameraY=0,i.setGlobalUniforms=function(e,n){e.use(),e.$uniVTime=n,e.$uniFTime=n,e.$uniScrW=window.innerWidth,e.$uniScrH=window.innerHeight,e.$uniGameW=i.GAME_W,e.$uniGameH=i.GAME_H,e.$uniCamX=i.cameraX,e.$uniCamY=i.cameraY},n.exports._=a});
//# sourceMappingURL=global.js.map
require("moon",function(r,t,e){var n,a,o,i=function(){function t(){return n(e,arguments)}var e={en:{},fr:{}},n=r("$").intl;return t.all=e,t}(),A=r("global"),_=r("hero"),l=r("programs"),f=4,u=null;e.ready=new Promise(function(r,t){r()}),e.reset=function(r){u||(u=r,a=u.createBuffer(),o=l(u,"Moon")),n=new Float32Array(f*A.NB_COLS),a=u.createBuffer();for(var t,e,i,_=0,O=0;O<A.NB_COLS;O++)t=A.COL_H/6*(.7+.6*Math.random()),e=Math.random()*A.COL_W+O*A.COL_W,i=Math.random()*(A.COL_H-2*t)+t,n[_++]=1,n[_++]=e,n[_++]=i,n[_++]=t},e.draw=function(r){u.blendFunc(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA),u.blendFuncSeparate(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA,u.ZERO,u.ONE),u.blendEquation(u.FUNC_ADD),A.setGlobalUniforms(o,r),u.bindBuffer(u.ARRAY_BUFFER,a),u.bufferData(u.ARRAY_BUFFER,n,u.STATIC_DRAW);var t=A.BPE*f;u.enableVertexAttribArray(o.$attType),u.vertexAttribPointer(o.$attType,1,u.FLOAT,!1,t,0),u.enableVertexAttribArray(o.$attPos),u.vertexAttribPointer(o.$attPos,2,u.FLOAT,!1,t,1*A.BPE),u.enableVertexAttribArray(o.$attSize),u.vertexAttribPointer(o.$attSize,1,u.FLOAT,!1,t,3*A.BPE),u.drawArrays(u.POINTS,0,A.NB_COLS)},e.move=function(r){var t=_.x(),e=_.y(),a=Math.floor(t/A.COL_W),o=(a+A.NB_COLS-1)%A.NB_COLS,i=(a+1)%A.NB_COLS;o*=f,a*=f,i*=f;var l,u,O,L;return u=n[o+1]-t,O=n[o+2]-e,L=n[o+3],l=u*u+O*O,l<L*L?_.collision(r):(u=n[a+1]-t,O=n[a+2]-e,L=n[a+3],l=u*u+O*O,l<L*L?_.collision(r):(u=n[i+1]-t,O=n[i+2]-e,L=n[i+3],l=u*u+O*O,l<L*L?_.collision(r):void 0))},t.exports._=i});
//# sourceMappingURL=moon.js.map
